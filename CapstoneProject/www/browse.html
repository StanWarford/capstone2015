<!DOCTYPE html>
<html>
	<head>
		<title>Page Title</title>
		<meta name = "viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="css/one.css" />
		<link rel="stylesheet" href="css/index.css" />
		<script src="jquery-1.11.2.min.js"></script>
		<script src="js/a.js"></script>
		<script src="js/b.js"></script>
		<link rel="stylesheet" href="css/peptheme.css">
		<script src="js/global.js"></script>
		<script>
			$(document).ready(function() {
				$.mobile.loading("show");
			});
		</script>
		<!--<script src="js/head.js"></script>-->
	</head>
	<body>
		<div data-role="page" data-theme="a" id="index">


			<div data-role="panel" id="mypanel">
				<ul data-role="listview" data-inset="true" style="min-width:210px;">
					<li><a href="search.html" class="ui-icon-search" data-ajax="false">Search</a></li>
					<li><a href="browse.html" class="ui-icon-grid" data-ajax="false">Browse</a></li>
					<li><a href="options.html" class="ui-icon-gear" data-ajax="false">Options</a></li>
					<li><a href="splash.html" data-ajax="false">Temp: Splash</a></li>
					<li><a href="first.html" data-ajax="false">Temp: First</a></li>
				</ul>
				<a href="#my-header" data-rel="close" class="ui-btn ui-corner-all ui-shadow ui-icon-delete ui-btn-icon-right ui-btn-a">Close panel</a>
			</div><!-- /panel -->
			<div data-role="header" id="my-header" data-theme="a" data-position="fixed">
				<a href="#mypanel" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-bars ui-btn-icon-left ui-btn-a menu">menu</a>
				<h1>Page Title</h1>
				<a href="index.html" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-home ui-btn-icon-right ui-btn-a menu" data-ajax="false">home</a>
			</div> <!-- /header -->

			
			<div data-role="content">
				<div id="departs" style="display:block">
					<div>
						<ul data-role="listview" style="padding-bottom:17px">
							<li class="ui-field-contain" id="listitem"><a class="ui-btn" style="text-align:center">Departments</a></li>
						</ul>
					</div>
					<!-- <ul data-role="listview" id="list-departments" data-inset="true"> -->
					<ul data-role="listview" id="list-departments" data-autodividers="true">
					</ul>
				</div>
				<div id="clases" style="display:none">
					<div>
						<ul data-role="listview" style="padding-bottom:17px">
							<li class="ui-field-contain" id="listitem"><a class="ui-btn ui-btn-icon-left ui-icon-carat-l" style="text-align:center" id="retDept">Back to Departments</a></li>
						</ul>
					</div>
					<ul data-role="listview" id="list-classes">
					</ul>
				</div>
				<div id="sects" style="display:none">
					<div>
						<ul data-role="listview" style="padding-bottom:17px">
							<li class="ui-field-contain" id="listitem"><a class="ui-btn ui-btn-icon-left ui-icon-carat-l" style="text-align:center"  id="retClas">Back to Classes</a></li>
						</ul>
					</div>
					<ul data-role="listview" id="list-sections">
					</ul>
				</div>
			</div> <!-- /content -->
			<div data-role="footer" data-theme="a" data-position="fixed">
				<h4>footer</h4>
			</div> <!-- /footer -->
			<script>
			$(document).on('pagebeforeshow', '#index', function(){
				$.ajax({
					url: "http://dbserver-capstone2015.rhcloud.com/get/classes",
					type: "GET",
					dataType: "text"
				}).done(function(result){
					// var json = JSON.parse(result);
					// for(var department in json){
					// 	for(var clas in json[department]){
					// 		for(var section in json[department][clas]){
					// 			console.log(json[department][clas][section]["section"]);
					// 			$('#list-classes').append('<li class="ui-field-contain" id="listitem'+i+'"></li>');
					// 			$('[class=ui-field-contain]').css('background-color','#b9cf96')
					// 			if(json[department][clas][section]["status"] == "closed") {
					// 				$('[class=ui-field-contain]').css('background-color','#f06d6d')
					// 			}
					// 			$('[class=ui-field-contain]').append(json[department][clas][section]["section"]);
					// 			$('[class=ui-field-contain]').append('<span class="flipperBrowse"><select id="flip2" data-role="slider" data-mini="true"><option value="off">Off</option><option value="on">On</option></select></span>');
					// 			$('#index').trigger('create');
					// 			$("#list-classes").listview("refresh"); 
					// 			i++;
					// 		}
					// 	}
					// }

					// var json = JSON.parse(result);
					// var json = {"COSC":{"COSC105":{"01":{"subject":"COSC","section":"COSC105.01","room":"RAC170","status":"open","professor":"Brad Cupp","day":"MoTh","time":"2:00PM-2:50PM"},"02":{"subject":"COSC","section":"COSC105.02","room":"RAC170","status":"closed","professor":"Brad Cupp","day":"MoTh","time":"3:00PM-3:50PM"}},"COSC330":{"01":{"subject":"COSC","section":"COSC330.01","room":"RAC170","status":"open","professor":"Stan Warford","day":"MoTh","time":"2:00PM-2:50PM"}}},"MATH":{"MATH151":{"01":{"subject":"MATH","section":"MATH151.01","room":"RAC170","status":"open","professor":"Brad Cupp","day":"MoTh","time":"2:00PM-2:50PM"},"02":{"subject":"MATH","section":"MATH151.02","room":"RAC170","status":"closed","professor":"Brad Cupp","day":"MoTh","time":"3:00PM-3:50PM"}}}};
					console.log(json);
					var deptArr = [];
					for(var department in json){
						deptArr.push(department);
					}
					deptArr.sort();
					var x = deptArr.length;
					for (var i = 0; i < x; i++) {
						deptQuote = '"' + deptArr[i] + '"';
						$('#list-departments').append("<li class='ui-field-contain'><a class='deptlink' onclick='showClasses("+deptQuote+")'></a></li>");
						$('[class=deptlink]').append(deptArr[i]);
						$('#list-departments').listview("refresh");
					}
					$.mobile.loading("hide");
				});	
			});
			function showClasses(depts) {
				$.mobile.loading("show");
				document.getElementById("departs").style.display = "none";
				document.getElementById("clases").style.display = "block";
				// $.ajax({
				// 	url: "http://dbserver-capstone2015.rhcloud.com/get/classes",
				// 	type: "GET",
				// 	dataType: "text",
				// }).done(function(result){
				// 	var json = JSON.parse(result);
					// var json = {"COSC":{"COSC105":{"01":{"subject":"COSC","section":"COSC105.01","room":"RAC170","status":"open","professor":"Brad Cupp","day":"MoTh","time":"2:00PM-2:50PM"},"02":{"subject":"COSC","section":"COSC105.02","room":"RAC170","status":"closed","professor":"Brad Cupp","day":"MoTh","time":"3:00PM-3:50PM"}},"COSC330":{"01":{"subject":"COSC","section":"COSC330.01","room":"RAC170","status":"open","professor":"Stan Warford","day":"MoTh","time":"2:00PM-2:50PM"}}},"MATH":{"MATH151":{"01":{"subject":"MATH","section":"MATH151.01","room":"RAC170","status":"open","professor":"Brad Cupp","day":"MoTh","time":"2:00PM-2:50PM"},"02":{"subject":"MATH","section":"MATH151.02","room":"RAC170","status":"closed","professor":"Brad Cupp","day":"MoTh","time":"3:00PM-3:50PM"}}}};
					for(var clas in json[depts]){
						clasQuote = '"' + clas + '"';
						deptsQuote = '"' + depts + '"';
						$('#list-classes').append("<li class='ui-field-contain'><a class='classlink' id='classitem' onclick='showSections("+clasQuote+","+deptsQuote+")' rel='external'></a></li>");
						$('[class=classlink]').append(clas);
						$('#list-classes').listview("refresh");
					}
					$.mobile.loading("hide");
				// });
			}
			function showSections(cls,dept) {
				$.mobile.loading("show");
				document.getElementById("clases").style.display = "none";
				document.getElementById("sects").style.display = "block";
				// $.ajax({
				// 	url: "http://dbserver-capstone2015.rhcloud.com/get/classes",
				// 	type: "GET",
				// 	dataType: "text"
				// }).done(function(result){
				// 	var json = JSON.parse(result);
					// var json = {"COSC":{"COSC105":{"01":{"subject":"COSC","section":"COSC105.01","room":"RAC170","status":"open","professor":"Brad Cupp","day":"MoTh","time":"2:00PM-2:50PM"},"02":{"subject":"COSC","section":"COSC105.02","room":"RAC170","status":"closed","professor":"Brad Cupp","day":"MoTh","time":"3:00PM-3:50PM"}},"COSC330":{"01":{"subject":"COSC","section":"COSC330.01","room":"RAC170","status":"open","professor":"Stan Warford","day":"MoTh","time":"2:00PM-2:50PM"}}},"MATH":{"MATH151":{"01":{"subject":"MATH","section":"MATH151.01","room":"RAC170","status":"open","professor":"Brad Cupp","day":"MoTh","time":"2:00PM-2:50PM"},"02":{"subject":"MATH","section":"MATH151.02","room":"RAC170","status":"closed","professor":"Brad Cupp","day":"MoTh","time":"3:00PM-3:50PM"}}}};

					var i = 1;
					for(var section in json[dept][cls]){
						clsQuote = '"' + cls + '"';
						deptQuote = '"' + dept + '"';
						sectQuote = '"' + section + '"';
						$('#list-sections').append('<li class="ui-field-contain" id="listitem'+i+'"></li>');
						$('#listitem'+i).css('background-color','#b9cf96');
						if(json[dept][cls][section]["status"] == "closed") {
							$('#listitem'+i).css('background-color','#f06d6d');
						}
						// $('#listitem'+i).append(json[dept][cls][section]["section"]);
						$('#listitem'+i).append(cls+"."+section);
						$('#listitem'+i).append("<span class='flipperBrowse'><select id='flip"+i+"' data-role='slider' data-mini='true' onchange='flipperChange("+deptQuote+","+clsQuote+","+sectQuote+",this.value)'><option value='off'>Off</option><option value='on'>On</option></select></span>");
						$('#index').trigger('create');
						$("#list-sections").listview("refresh"); 
						i++;
					}
					$.mobile.loading("hide");
				// });
			}
			function flipperChange(deptFlip,clasFlip,sectFlip,val) {
				console.log(deptFlip + clasFlip + sectFlip + val);
			}
			document.getElementById("retDept").onclick = function returnDept() {
				document.getElementById("clases").style.display = "none";
				document.getElementById("departs").style.display = "block";
				$("#list-classes").empty();
			}
			document.getElementById("retClas").onclick = function returnDept() {
				document.getElementById("sects").style.display = "none";
				document.getElementById("clases").style.display = "block";
				$("#list-sections").empty();
			}
			</script>
		</div> <!-- /page -->
	</body>
</html>